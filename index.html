<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶°‡ßç‡¶∞‡¶Ø‡¶º‡¶ø‡¶Ç ‡¶™‡ßç‡¶Ø‡¶æ‡¶° | Drawing Pad</title>
    <link href="https://fonts.googleapis.com/css2?family=Baloo+Da+2:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #f0f4ff;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #2d3748;
            --text-secondary: #718096;
            --accent: #6366f1;
            --accent-hover: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #e2e8f0;
            --shadow: rgba(99, 102, 241, 0.15);
            --canvas-bg: #ffffff;
            --toolbar-bg: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #818cf8;
            --accent-hover: #6366f1;
            --border: #334155;
            --shadow: rgba(0, 0, 0, 0.3);
            --canvas-bg: #ffffff;
            --toolbar-bg: linear-gradient(135deg, #4c1d95 0%, #5b21b6 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Baloo Da 2', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Header */
        .header {
            background: var(--toolbar-bg);
            padding: 12px 16px;
            color: white;
            box-shadow: 0 4px 20px var(--shadow);
        }

        .header h1 {
            font-size: 1.4rem;
            font-weight: 700;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .header h1 span {
            display: inline-block;
            animation: bounce 0.6s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-3px); }
        }

        /* Module Tabs */
        .module-tabs {
            display: flex;
            overflow-x: auto;
            background: var(--bg-secondary);
            padding: 8px;
            gap: 6px;
            border-bottom: 2px solid var(--border);
            scrollbar-width: none;
        }

        .module-tabs::-webkit-scrollbar {
            display: none;
        }

        .tab-btn {
            flex-shrink: 0;
            padding: 8px 14px;
            border: none;
            border-radius: 20px;
            font-family: inherit;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            background: var(--bg-primary);
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .tab-btn:hover:not(.active) {
            background: var(--border);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 12px;
            gap: 12px;
        }

        /* Item Navigation */
        .item-nav {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            background: var(--bg-card);
            padding: 10px 16px;
            border-radius: 16px;
            box-shadow: 0 4px 15px var(--shadow);
        }

        .nav-btn {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-btn:hover {
            background: var(--accent-hover);
            transform: scale(1.1);
        }

        .nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        .current-item {
            font-size: 2.5rem;
            font-weight: 700;
            min-width: 80px;
            text-align: center;
            color: var(--accent);
            text-shadow: 2px 2px 0 var(--border);
        }

        .item-counter {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Canvas Container */
        .canvas-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            border-radius: 20px;
            box-shadow: 0 8px 30px var(--shadow);
            overflow: hidden;
            min-height: 300px;
        }

        .canvas-wrapper {
            flex: 1;
            position: relative;
            background: var(--canvas-bg);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        #drawingCanvas {
            touch-action: none;
            cursor: crosshair;
            max-width: 100%;
            max-height: 100%;
        }

        .template-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12rem;
            color: rgba(99, 102, 241, 0.12);
            pointer-events: none;
            z-index: 1;
            font-weight: 700;
            line-height: 1;
        }

        .template-svg {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 70%;
            height: 70%;
            pointer-events: none;
            z-index: 1;
            opacity: 0.15;
        }

        /* Toolbar */
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            padding: 12px;
            background: var(--bg-secondary);
            border-top: 2px solid var(--border);
            justify-content: center;
        }

        .tool-group {
            display: flex;
            gap: 6px;
            align-items: center;
        }

        .tool-btn {
            width: 42px;
            height: 42px;
            border: 2px solid var(--border);
            border-radius: 12px;
            background: var(--bg-card);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .tool-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px var(--shadow);
        }

        .tool-btn.active {
            border-color: var(--accent);
            background: var(--accent);
            color: white;
        }

        /* Color Palette */
        .color-palette {
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 200px;
        }

        .color-btn {
            width: 28px;
            height: 28px;
            border: 2px solid transparent;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-btn:hover {
            transform: scale(1.2);
        }

        .color-btn.active {
            border-color: var(--text-primary);
            box-shadow: 0 0 0 3px var(--bg-card), 0 0 0 5px currentColor;
        }

        /* Brush Size */
        .brush-size {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .brush-size input {
            width: 80px;
            accent-color: var(--accent);
        }

        .size-preview {
            width: 30px;
            height: 30px;
            background: var(--accent);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .size-dot {
            background: white;
            border-radius: 50%;
        }

        /* Action Buttons */
        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-clear {
            background: var(--danger);
            color: white;
        }

        .btn-save {
            background: var(--success);
            color: white;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px var(--shadow);
        }

        /* Responsive */
        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.1rem;
            }

            .tab-btn {
                padding: 6px 10px;
                font-size: 0.75rem;
            }

            .current-item {
                font-size: 2rem;
            }

            .template-overlay {
                font-size: 8rem;
            }

            .tool-btn {
                width: 36px;
                height: 36px;
            }

            .color-btn {
                width: 24px;
                height: 24px;
            }
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--success);
            color: white;
            padding: 12px 24px;
            border-radius: 30px;
            font-weight: 600;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
        }

        /* Confetti Animation */
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            pointer-events: none;
            z-index: 999;
            animation: confetti-fall 3s ease-out forwards;
        }

        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateY(100vh) rotate(720deg);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <header class="header">
            <h1>
                <span style="animation-delay: 0s">üé®</span>
                <span style="animation-delay: 0.1s">‡¶°‡ßç‡¶∞</span><span style="animation-delay: 0.15s">‡¶Ø‡¶º‡¶ø‡¶Ç</span>
                <span style="animation-delay: 0.2s">‡¶™‡ßç‡¶Ø‡¶æ</span><span style="animation-delay: 0.25s">‡¶°</span>
                <span style="animation-delay: 0.3s">‚úèÔ∏è</span>
            </h1>
        </header>

        <nav class="module-tabs" id="moduleTabs">
            <button class="tab-btn active" data-module="english">üî§ English</button>
            <button class="tab-btn" data-module="numbers">üî¢ Numbers</button>
            <button class="tab-btn" data-module="swarabarna">‡¶Ö ‡¶∏‡ßç‡¶¨‡¶∞‡¶¨‡¶∞‡ßç‡¶£</button>
            <button class="tab-btn" data-module="banjonbarna">‡¶ï ‡¶¨‡ßç‡¶Ø‡¶û‡ßç‡¶ú‡¶®‡¶¨‡¶∞‡ßç‡¶£</button>
            <button class="tab-btn" data-module="fruits">üçé ‡¶´‡¶≤</button>
            <button class="tab-btn" data-module="cars">üöó ‡¶ó‡¶æ‡¶°‡¶º‡¶ø</button>
        </nav>

        <main class="main-content">
            <div class="item-nav">
                <button class="nav-btn" id="prevBtn">‚óÄ</button>
                <div style="text-align: center;">
                    <div class="current-item" id="currentItem">A</div>
                    <div class="item-counter" id="itemCounter">1 / 26</div>
                </div>
                <button class="nav-btn" id="nextBtn">‚ñ∂</button>
            </div>

            <div class="canvas-container">
                <div class="canvas-wrapper">
                    <div class="template-overlay" id="templateOverlay">A</div>
                    <svg class="template-svg" id="templateSvg" style="display: none;"></svg>
                    <canvas id="drawingCanvas"></canvas>
                </div>

                <div class="toolbar">
                    <div class="tool-group">
                        <button class="tool-btn active" id="penTool" title="‡¶ï‡¶≤‡¶Æ">‚úèÔ∏è</button>
                        <button class="tool-btn" id="eraserTool" title="‡¶á‡¶∞‡ßá‡¶ú‡¶æ‡¶∞">üßΩ</button>
                    </div>

                    <div class="color-palette" id="colorPalette"></div>

                    <div class="brush-size">
                        <div class="size-preview">
                            <div class="size-dot" id="sizeDot"></div>
                        </div>
                        <input type="range" id="brushSize" min="2" max="30" value="8">
                    </div>

                    <div class="tool-group">
                        <button class="action-btn btn-clear" id="clearBtn">üóëÔ∏è ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                        <button class="action-btn btn-save" id="saveBtn">üíæ ‡¶∏‡ßá‡¶≠</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="toast" id="toast">‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‚ú®</div>

    <script>
        // Dark mode detection
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Module Data
        const modules = {
            english: {
                items: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split(''),
                type: 'text'
            },
            numbers: {
                items: '0123456789'.split(''),
                type: 'text'
            },
            swarabarna: {
                items: ['‡¶Ö', '‡¶Ü', '‡¶á', '‡¶à', '‡¶â', '‡¶ä', '‡¶ã', '‡¶è', '‡¶ê', '‡¶ì', '‡¶î'],
                type: 'text'
            },
            banjonbarna: {
                items: ['‡¶ï', '‡¶ñ', '‡¶ó', '‡¶ò', '‡¶ô', '‡¶ö', '‡¶õ', '‡¶ú', '‡¶ù', '‡¶û', '‡¶ü', '‡¶†', '‡¶°', '‡¶¢', '‡¶£', '‡¶§', '‡¶•', '‡¶¶', '‡¶ß', '‡¶®', '‡¶™', '‡¶´', '‡¶¨', '‡¶≠', '‡¶Æ', '‡¶Ø', '‡¶∞', '‡¶≤', '‡¶∂', '‡¶∑', '‡¶∏', '‡¶π', '‡¶°‡¶º', '‡¶¢‡¶º', '‡¶Ø‡¶º', '‡ßé', '‡¶Ç', '‡¶É', '‡¶Å'],
                type: 'text'
            },
            fruits: {
                items: [
                    { name: 'üçé ‡¶Ü‡¶™‡ßá‡¶≤', svg: 'apple' },
                    { name: 'üçå ‡¶ï‡¶≤‡¶æ', svg: 'banana' },
                    { name: 'üçá ‡¶Ü‡¶ô‡ßÅ‡¶∞', svg: 'grapes' },
                    { name: 'üçä ‡¶ï‡¶Æ‡¶≤‡¶æ', svg: 'orange' },
                    { name: 'üçì ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶¨‡ßá‡¶∞‡¶ø', svg: 'strawberry' },
                    { name: 'üçâ ‡¶§‡¶∞‡¶Æ‡ßÅ‡¶ú', svg: 'watermelon' },
                    { name: 'ü•≠ ‡¶Ü‡¶Æ', svg: 'mango' },
                    { name: 'üçç ‡¶Ü‡¶®‡¶æ‡¶∞‡¶∏', svg: 'pineapple' }
                ],
                type: 'svg'
            },
            cars: {
                items: [
                    { name: 'üöó ‡¶∏‡ßá‡¶°‡¶æ‡¶®', svg: 'sedan' },
                    { name: 'üöô SUV', svg: 'suv' },
                    { name: 'üöå ‡¶¨‡¶æ‡¶∏', svg: 'bus' },
                    { name: 'üöï ‡¶ü‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡¶ø', svg: 'taxi' },
                    { name: 'üöì ‡¶™‡ßÅ‡¶≤‡¶ø‡¶∂', svg: 'police' },
                    { name: 'üöí ‡¶´‡¶æ‡¶Ø‡¶º‡¶æ‡¶∞', svg: 'firetruck' },
                    { name: 'üèéÔ∏è ‡¶∞‡ßá‡¶∏', svg: 'racecar' },
                    { name: 'üöö ‡¶ü‡ßç‡¶∞‡¶æ‡¶ï', svg: 'truck' }
                ],
                type: 'svg'
            }
        };

        // SVG Templates
        const svgTemplates = {
            apple: `<path d="M50 15 Q55 5 65 10 Q70 15 65 20 L55 25 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                    <ellipse cx="50" cy="55" rx="30" ry="35" fill="none" stroke="currentColor" stroke-width="3"/>
                    <path d="M50 20 Q50 30 45 35" fill="none" stroke="currentColor" stroke-width="2"/>`,
            banana: `<path d="M20 70 Q25 30 50 25 Q80 20 85 40 Q80 45 50 40 Q30 50 25 70 Z" fill="none" stroke="currentColor" stroke-width="3"/>`,
            grapes: `<circle cx="40" cy="35" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="60" cy="35" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="30" cy="50" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="50" cy="50" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="70" cy="50" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="40" cy="65" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="60" cy="65" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <circle cx="50" cy="80" r="10" fill="none" stroke="currentColor" stroke-width="2"/>
                     <path d="M50 15 L50 25" stroke="currentColor" stroke-width="3"/>`,
            orange: `<circle cx="50" cy="50" r="35" fill="none" stroke="currentColor" stroke-width="3"/>
                     <ellipse cx="50" cy="18" rx="8" ry="5" fill="none" stroke="currentColor" stroke-width="2"/>`,
            strawberry: `<path d="M50 15 Q30 25 25 50 Q25 75 50 85 Q75 75 75 50 Q70 25 50 15 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                         <path d="M40 10 Q50 5 60 10" fill="none" stroke="currentColor" stroke-width="2"/>
                         <circle cx="40" cy="40" r="2" fill="currentColor"/>
                         <circle cx="55" cy="35" r="2" fill="currentColor"/>
                         <circle cx="45" cy="55" r="2" fill="currentColor"/>
                         <circle cx="60" cy="50" r="2" fill="currentColor"/>
                         <circle cx="50" cy="70" r="2" fill="currentColor"/>`,
            watermelon: `<path d="M15 60 Q50 20 85 60 L85 65 Q50 25 15 65 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                         <ellipse cx="50" cy="62" rx="35" ry="20" fill="none" stroke="currentColor" stroke-width="3"/>`,
            mango: `<ellipse cx="50" cy="50" rx="25" ry="35" fill="none" stroke="currentColor" stroke-width="3" transform="rotate(-20 50 50)"/>
                    <path d="M60 20 Q70 10 75 15" fill="none" stroke="currentColor" stroke-width="2"/>`,
            pineapple: `<ellipse cx="50" cy="55" rx="22" ry="30" fill="none" stroke="currentColor" stroke-width="3"/>
                        <path d="M35 25 Q30 10 35 5" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M50 25 Q50 5 55 0" fill="none" stroke="currentColor" stroke-width="2"/>
                        <path d="M65 25 Q70 10 65 5" fill="none" stroke="currentColor" stroke-width="2"/>
                        <line x1="35" y1="45" x2="65" y2="45" stroke="currentColor" stroke-width="1"/>
                        <line x1="32" y1="55" x2="68" y2="55" stroke="currentColor" stroke-width="1"/>
                        <line x1="35" y1="65" x2="65" y2="65" stroke="currentColor" stroke-width="1"/>`,
            sedan: `<path d="M10 60 L10 50 L25 50 L35 35 L65 35 L75 50 L90 50 L90 60 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                    <circle cx="25" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                    <circle cx="75" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                    <line x1="38" y1="35" x2="38" y2="50" stroke="currentColor" stroke-width="2"/>
                    <line x1="55" y1="35" x2="55" y2="50" stroke="currentColor" stroke-width="2"/>`,
            suv: `<path d="M10 55 L10 45 L20 45 L30 30 L70 30 L80 45 L90 45 L90 55 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                  <circle cx="25" cy="55" r="10" fill="none" stroke="currentColor" stroke-width="3"/>
                  <circle cx="75" cy="55" r="10" fill="none" stroke="currentColor" stroke-width="3"/>
                  <line x1="35" y1="30" x2="35" y2="45" stroke="currentColor" stroke-width="2"/>
                  <line x1="55" y1="30" x2="55" y2="45" stroke="currentColor" stroke-width="2"/>`,
            bus: `<rect x="10" y="30" width="80" height="35" rx="5" fill="none" stroke="currentColor" stroke-width="3"/>
                  <circle cx="25" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                  <circle cx="75" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                  <line x1="30" y1="30" x2="30" y2="55" stroke="currentColor" stroke-width="2"/>
                  <line x1="50" y1="30" x2="50" y2="55" stroke="currentColor" stroke-width="2"/>
                  <line x1="70" y1="30" x2="70" y2="55" stroke="currentColor" stroke-width="2"/>`,
            taxi: `<path d="M10 60 L10 50 L25 50 L35 35 L65 35 L75 50 L90 50 L90 60 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                   <circle cx="25" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                   <circle cx="75" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                   <rect x="40" y="25" width="20" height="10" fill="none" stroke="currentColor" stroke-width="2"/>`,
            police: `<path d="M10 60 L10 50 L25 50 L35 35 L65 35 L75 50 L90 50 L90 60 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                     <circle cx="25" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                     <circle cx="75" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                     <ellipse cx="50" cy="28" rx="8" ry="5" fill="none" stroke="currentColor" stroke-width="2"/>`,
            firetruck: `<rect x="5" y="40" width="40" height="25" rx="3" fill="none" stroke="currentColor" stroke-width="3"/>
                        <rect x="45" y="35" width="50" height="30" rx="3" fill="none" stroke="currentColor" stroke-width="3"/>
                        <circle cx="20" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                        <circle cx="60" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                        <circle cx="80" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                        <line x1="55" y1="25" x2="85" y2="25" stroke="currentColor" stroke-width="3"/>`,
            racecar: `<path d="M5 55 L15 55 L25 45 L75 45 L85 55 L95 55 L95 60 L5 60 Z" fill="none" stroke="currentColor" stroke-width="3"/>
                      <circle cx="25" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                      <circle cx="75" cy="60" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                      <path d="M40 45 L40 35 L60 35 L60 45" fill="none" stroke="currentColor" stroke-width="2"/>`,
            truck: `<rect x="5" y="40" width="35" height="25" rx="3" fill="none" stroke="currentColor" stroke-width="3"/>
                    <rect x="40" y="30" width="55" height="35" rx="3" fill="none" stroke="currentColor" stroke-width="3"/>
                    <circle cx="20" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                    <circle cx="60" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>
                    <circle cx="80" cy="65" r="8" fill="none" stroke="currentColor" stroke-width="3"/>`
        };

        // Color Palette
        const colors = [
            '#ef4444', '#f97316', '#eab308', '#22c55e', '#14b8a6',
            '#3b82f6', '#8b5cf6', '#ec4899', '#000000', '#6b7280'
        ];

        // State
        let currentModule = 'english';
        let currentIndex = 0;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let currentColor = colors[0];
        let brushSize = 8;
        let isEraser = false;

        // DOM Elements
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const templateOverlay = document.getElementById('templateOverlay');
        const templateSvg = document.getElementById('templateSvg');
        const currentItemDisplay = document.getElementById('currentItem');
        const itemCounter = document.getElementById('itemCounter');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const colorPalette = document.getElementById('colorPalette');
        const brushSizeInput = document.getElementById('brushSize');
        const sizeDot = document.getElementById('sizeDot');
        const penTool = document.getElementById('penTool');
        const eraserTool = document.getElementById('eraserTool');
        const clearBtn = document.getElementById('clearBtn');
        const saveBtn = document.getElementById('saveBtn');
        const toast = document.getElementById('toast');

        // Initialize
        function init() {
            setupCanvas();
            setupColorPalette();
            setupEventListeners();
            updateDisplay();
        }

        function setupCanvas() {
            const wrapper = canvas.parentElement;
            const rect = wrapper.getBoundingClientRect();
            const size = Math.min(rect.width, rect.height, 500);
            canvas.width = size;
            canvas.height = size;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            clearCanvas();
        }

        function setupColorPalette() {
            colorPalette.innerHTML = colors.map((color, i) =>
                `<button class="color-btn ${i === 0 ? 'active' : ''}"
                         style="background: ${color}"
                         data-color="${color}"></button>`
            ).join('');
        }

        function setupEventListeners() {
            // Module tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelector('.tab-btn.active').classList.remove('active');
                    btn.classList.add('active');
                    currentModule = btn.dataset.module;
                    currentIndex = 0;
                    updateDisplay();
                    clearCanvas();
                });
            });

            // Navigation
            prevBtn.addEventListener('click', () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateDisplay();
                    clearCanvas();
                }
            });

            nextBtn.addEventListener('click', () => {
                const items = modules[currentModule].items;
                if (currentIndex < items.length - 1) {
                    currentIndex++;
                    updateDisplay();
                    clearCanvas();
                }
            });

            // Color palette
            colorPalette.addEventListener('click', (e) => {
                if (e.target.classList.contains('color-btn')) {
                    document.querySelector('.color-btn.active')?.classList.remove('active');
                    e.target.classList.add('active');
                    currentColor = e.target.dataset.color;
                    isEraser = false;
                    penTool.classList.add('active');
                    eraserTool.classList.remove('active');
                }
            });

            // Brush size
            brushSizeInput.addEventListener('input', (e) => {
                brushSize = parseInt(e.target.value);
                updateSizeDot();
            });
            updateSizeDot();

            // Tools
            penTool.addEventListener('click', () => {
                isEraser = false;
                penTool.classList.add('active');
                eraserTool.classList.remove('active');
            });

            eraserTool.addEventListener('click', () => {
                isEraser = true;
                eraserTool.classList.add('active');
                penTool.classList.remove('active');
            });

            // Clear and Save
            clearBtn.addEventListener('click', clearCanvas);
            saveBtn.addEventListener('click', saveDrawing);

            // Canvas drawing - Mouse
            canvas.addEventListener('mousedown', startDrawing);
            canvas.addEventListener('mousemove', draw);
            canvas.addEventListener('mouseup', stopDrawing);
            canvas.addEventListener('mouseout', stopDrawing);

            // Canvas drawing - Touch
            canvas.addEventListener('touchstart', handleTouchStart, { passive: false });
            canvas.addEventListener('touchmove', handleTouchMove, { passive: false });
            canvas.addEventListener('touchend', stopDrawing);

            // Resize
            window.addEventListener('resize', debounce(() => {
                const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                setupCanvas();
                ctx.putImageData(imageData, 0, 0);
            }, 250));
        }

        function updateSizeDot() {
            const size = Math.max(4, brushSize);
            sizeDot.style.width = size + 'px';
            sizeDot.style.height = size + 'px';
        }

        function updateDisplay() {
            const module = modules[currentModule];
            const items = module.items;
            const item = items[currentIndex];

            if (module.type === 'text') {
                templateOverlay.textContent = item;
                templateOverlay.style.display = 'block';
                templateSvg.style.display = 'none';
                currentItemDisplay.textContent = item;
            } else {
                templateOverlay.style.display = 'none';
                templateSvg.style.display = 'block';
                templateSvg.innerHTML = `<svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">${svgTemplates[item.svg]}</svg>`;
                currentItemDisplay.textContent = item.name;
            }

            itemCounter.textContent = `${currentIndex + 1} / ${items.length}`;
            prevBtn.disabled = currentIndex === 0;
            nextBtn.disabled = currentIndex === items.length - 1;
        }

        function getCoords(e) {
            const rect = canvas.getBoundingClientRect();
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            if (e.touches) {
                return {
                    x: (e.touches[0].clientX - rect.left) * scaleX,
                    y: (e.touches[0].clientY - rect.top) * scaleY
                };
            }
            return {
                x: (e.clientX - rect.left) * scaleX,
                y: (e.clientY - rect.top) * scaleY
            };
        }

        function startDrawing(e) {
            isDrawing = true;
            const coords = getCoords(e);
            lastX = coords.x;
            lastY = coords.y;

            // Draw a dot for single clicks
            ctx.beginPath();
            ctx.arc(lastX, lastY, brushSize / 2, 0, Math.PI * 2);
            ctx.fillStyle = isEraser ? '#ffffff' : currentColor;
            ctx.fill();
        }

        function draw(e) {
            if (!isDrawing) return;

            const coords = getCoords(e);

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(coords.x, coords.y);
            ctx.strokeStyle = isEraser ? '#ffffff' : currentColor;
            ctx.lineWidth = brushSize;
            ctx.stroke();

            lastX = coords.x;
            lastY = coords.y;
        }

        function stopDrawing() {
            isDrawing = false;
        }

        function handleTouchStart(e) {
            e.preventDefault();
            startDrawing(e);
        }

        function handleTouchMove(e) {
            e.preventDefault();
            draw(e);
        }

        function clearCanvas() {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function saveDrawing() {
            const link = document.createElement('a');
            const module = modules[currentModule];
            const item = module.type === 'text' ? module.items[currentIndex] : module.items[currentIndex].name;
            link.download = `drawing-${item}-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();

            showToast('‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá! ‚ú®');
            createConfetti();
        }

        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function createConfetti() {
            const confettiColors = ['#ef4444', '#f97316', '#eab308', '#22c55e', '#3b82f6', '#8b5cf6', '#ec4899'];
            for (let i = 0; i < 30; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.top = '-10px';
                confetti.style.background = confettiColors[Math.floor(Math.random() * confettiColors.length)];
                confetti.style.animationDuration = (2 + Math.random() * 2) + 's';
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                document.body.appendChild(confetti);

                setTimeout(() => confetti.remove(), 4000);
            }
        }

        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Start the app
        init();
    </script>
</body>
</html>
